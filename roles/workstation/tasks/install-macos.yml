---
- name: Install base packages
  homebrew:
    name: "{{ item }}"
    state: present
  with_items:
   - zsh  # Changing shell
   - curl  # Installing
   - git  # Cloning stuff
   - luarocks  # Spacehammer/fennel
   - antigen  # Shell config

- name: Restore all packages
  command: brew bundle --file=Brewfile
  tags: [brew, extra]

# - name: Link openssl
#   file:
#     path: /usr/local/lib/{{ item }}.dylib
#     src: /usr/local/opt/openssl/lib/{{ item }}.dylib
#     state: link
#   with_items:
#     - libssl
#     - libcrypto

- name: Add brew zsh as allowed shell
  become: yes
  template:
    src: templates/shells.j2
    dest: /etc/shells
  tags: [zsh]

- name: Set loginshell
  become: true
  shell: chsh -s /usr/local/bin/zsh
  tags: [zsh]
